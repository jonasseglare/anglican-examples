;; gorilla-repl.fileformat = 1

;; **
;;; # INTERNAL RATE OF RETURN, PART II
;;; 
;;; 
;; **

;; @@
(ns irr-1
  (:require [gorilla-plot.core :as plot]
            [clojure.core.matrix :as m])
  (:use clojure.repl
        clojure.pprint
        [anglican core runtime emit stat]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; In this exercise, we re-analyze the same financial data from last time, but using a very different model. We will see that, where the previous model (the discrete-time Gaussian random walk) was skittish about our proposed investment, the model we discuss this time (the continuous-time geometric Brownian motion) will be bullish.
;;; 
;;; In this worksheet, we will infer the drift of a geometric Brownian motion process (GBM). The geometric Brownian motion process is a transformation of the Brownian motion process, which is a Gaussian process. Therefore, we will need the below code for calculating the log-evidence of a Gaussian process:
;; **

;; @@
;; my GP code:

(defprotocol random-process2
  (evidence [this]
            "returns the log model evidence of the current state of the process"))



;; some useful helpers:

(defn ^:private uncps
  "reconstructs value-returning function from CPS form"
  [f]
  (fn [& args]
    (trampoline (apply f (fn [v _] v) nil args))))

(defn ^:private cps
  "wrap value-returning function into CPS form"
  [f]
  (fn [cont $state & args]
    (fn [] (cont (apply f args) $state))))

(defdist dirac [x]
  (sample* [this] x)
  (observe* [this value]
            (if (= value x)
              0
              (- (/ 1.0 0.0)))))


(defn- cov2
  "computes covariance matrix of xs and ys under k"
  [k xs ys]
  (m/matrix (for [x xs]
              (for [y ys]
                (k x y)))))


(defn compute-Kinv [k points]
  (let [xs (map first points)
        K (cov2 k xs xs)]
    (m/inverse K)))




;; the GP with evidence:

(defproc GP-new [m$ k$] [m (uncps m$)
                         k (uncps k$)
                         points []
                         Kinv-computer nil]

  (produce [this]
           (cps

             (if (not (seq points))
               (fn [x] (normal (m x) (sqrt (k x x))))

               (let [xs (mapv first points)
                     ys (mapv second points)
                     ms (mapv m xs)
                     es (m/sub ys ms)
                     Kinv @Kinv-computer
                     zs (m/mmul Kinv es)]

                 (fn [x]
                   (let [mx (m x)
                         sgm (cov2 k xs [x])
                         mean (+ mx (first (m/mmul (m/transpose sgm) zs)))
                         var (- (k x x)
                                (ffirst
                                  (m/mmul (m/transpose sgm) Kinv sgm)))]
                     (if (> var 0)
                       (normal mean (sqrt var))
                       (dirac mean))))))))

  (absorb [this sample]
          (let [points (conj points sample)]
            (GP-new m$ k$ m k points
                    (delay (compute-Kinv k points)))))

  random-process2
  (evidence [this]
            (if (not (seq points))
              0
              (let [xs (mapv first points)
                    ys (mapv second points)
                    ms (mapv m xs)
                    es (m/sub ys ms)
                    N (count points)

                    Kinv @Kinv-computer]

                (* 0.5 (+
                         (- (ffirst (m/mul (m/transpose es) Kinv es)))
                         (Math/log (m/det Kinv)) ;; det(Kinv) = 1/det(K) -> log(det(K)) = -1*log(det(Kinv))
                         (- (* N (Math/log (* 2 (Math/PI)))))))))))

;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-symbol'>random-process2</span>","value":"random-process2"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/uncps</span>","value":"#'irr-1/uncps"}],"value":"[random-process2,#'irr-1/uncps]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/cps</span>","value":"#'irr-1/cps"}],"value":"[[random-process2,#'irr-1/uncps],#'irr-1/cps]"},{"type":"html","content":"<span class='clj-unkown'>#multifn[print-method 0x3dbf8575]</span>","value":"#multifn[print-method 0x3dbf8575]"}],"value":"[[[random-process2,#'irr-1/uncps],#'irr-1/cps],#multifn[print-method 0x3dbf8575]]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/cov2</span>","value":"#'irr-1/cov2"}],"value":"[[[[random-process2,#'irr-1/uncps],#'irr-1/cps],#multifn[print-method 0x3dbf8575]],#'irr-1/cov2]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/compute-Kinv</span>","value":"#'irr-1/compute-Kinv"}],"value":"[[[[[random-process2,#'irr-1/uncps],#'irr-1/cps],#multifn[print-method 0x3dbf8575]],#'irr-1/cov2],#'irr-1/compute-Kinv]"},{"type":"html","content":"<span class='clj-unkown'>#multifn[print-method 0x3dbf8575]</span>","value":"#multifn[print-method 0x3dbf8575]"}],"value":"[[[[[[random-process2,#'irr-1/uncps],#'irr-1/cps],#multifn[print-method 0x3dbf8575]],#'irr-1/cov2],#'irr-1/compute-Kinv],#multifn[print-method 0x3dbf8575]]"}
;; <=

;; **
;;; Below is our financial time series from before. By plotting the logarithm of this process with time, we can see that an exponential model - geometric Brownian motion - is a much better fit for this data than a linear model. This is an indication that our results in this worksheet will be much more accurate than our results from the last worksheet.
;; **

;; @@
(def times [1 2 3 4 5 6 7 8 9])

(def true-mu 0.2)
(def true-delta 0.1)
(def true-const (Math/log 10))
(def true-drift (- true-mu (* true-delta true-delta 0.5)))

(def values [12.1 11.99 15.05 19.99 24.59 35.04 43.84 42.82 46.14])

(def data (mapv (fn [t v] [t v]) times values))

(def transformed-data (mapv (fn [[t v]] [t (Math/log v)]) data))


(plot/compose
  (plot/list-plot transformed-data :plot-range [[1 10] :all])
  (plot/plot #(+ true-const (* true-drift %)) [1 9]))


(plot/compose
  (plot/list-plot data :plot-range [[1 10] :all])
  (plot/plot #(Math/exp (+ true-const (* true-drift %))) [1 9]))
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/times</span>","value":"#'irr-1/times"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/true-mu</span>","value":"#'irr-1/true-mu"}],"value":"[#'irr-1/times,#'irr-1/true-mu]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/true-delta</span>","value":"#'irr-1/true-delta"}],"value":"[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/true-const</span>","value":"#'irr-1/true-const"}],"value":"[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/true-drift</span>","value":"#'irr-1/true-drift"}],"value":"[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/values</span>","value":"#'irr-1/values"}],"value":"[[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift],#'irr-1/values]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/data</span>","value":"#'irr-1/data"}],"value":"[[[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift],#'irr-1/values],#'irr-1/data]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/transformed-data</span>","value":"#'irr-1/transformed-data"}],"value":"[[[[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift],#'irr-1/values],#'irr-1/data],#'irr-1/transformed-data]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[1,10]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"f438c4db-e27c-4ced-bb7e-17915263ab77","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"f438c4db-e27c-4ced-bb7e-17915263ab77","values":[{"x":1,"y":2.4932054526026954},{"x":2,"y":2.4840729690394228},{"x":3,"y":2.711377991194885},{"x":4,"y":2.995232148512309},{"x":5,"y":3.202339856228101},{"x":6,"y":3.5564902660681907},{"x":7,"y":3.7805466426397603},{"x":8,"y":3.757005283161537},{"x":9,"y":3.8316802527456075}]},{"name":"1850e752-8a8f-4406-8f4e-aa7d5ffdb011","values":[{"x":1,"y":2.4975850929940457},{"x":1.0799999982118607,"y":2.513185092645359},{"x":1.1599999964237213,"y":2.5287850922966717},{"x":1.239999994635582,"y":2.5443850919479845},{"x":1.3199999928474426,"y":2.559985091599297},{"x":1.3999999910593033,"y":2.57558509125061},{"x":1.479999989271164,"y":2.5911850909019227},{"x":1.5599999874830246,"y":2.6067850905532355},{"x":1.6399999856948853,"y":2.6223850902045487},{"x":1.719999983906746,"y":2.6379850898558614},{"x":1.7999999821186066,"y":2.653585089507174},{"x":1.8799999803304672,"y":2.669185089158487},{"x":1.9599999785423279,"y":2.6847850888097997},{"x":2.0399999767541885,"y":2.700385088461113},{"x":2.119999974966049,"y":2.7159850881124257},{"x":2.19999997317791,"y":2.7315850877637384},{"x":2.2799999713897705,"y":2.747185087415051},{"x":2.359999969601631,"y":2.762785087066364},{"x":2.439999967813492,"y":2.7783850867176767},{"x":2.5199999660253525,"y":2.7939850863689895},{"x":2.599999964237213,"y":2.809585086020302},{"x":2.679999962449074,"y":2.8251850856716154},{"x":2.7599999606609344,"y":2.840785085322928},{"x":2.839999958872795,"y":2.856385084974241},{"x":2.9199999570846558,"y":2.8719850846255537},{"x":2.9999999552965164,"y":2.887585084276867},{"x":3.079999953508377,"y":2.9031850839281796},{"x":3.1599999517202377,"y":2.9187850835794924},{"x":3.2399999499320984,"y":2.934385083230805},{"x":3.319999948143959,"y":2.949985082882118},{"x":3.3999999463558197,"y":2.9655850825334307},{"x":3.4799999445676804,"y":2.9811850821847434},{"x":3.559999942779541,"y":2.996785081836056},{"x":3.6399999409914017,"y":3.0123850814873694},{"x":3.7199999392032623,"y":3.027985081138682},{"x":3.799999937415123,"y":3.043585080789995},{"x":3.8799999356269836,"y":3.0591850804413077},{"x":3.9599999338388443,"y":3.0747850800926204},{"x":4.039999932050705,"y":3.0903850797439336},{"x":4.119999930262566,"y":3.1059850793952464},{"x":4.199999928474426,"y":3.121585079046559},{"x":4.279999926686287,"y":3.137185078697872},{"x":4.359999924898148,"y":3.1527850783491846},{"x":4.439999923110008,"y":3.1683850780004974},{"x":4.519999921321869,"y":3.18398507765181},{"x":4.5999999195337296,"y":3.1995850773031234},{"x":4.67999991774559,"y":3.215185076954436},{"x":4.759999915957451,"y":3.230785076605749},{"x":4.8399999141693115,"y":3.2463850762570616},{"x":4.919999912381172,"y":3.2619850759083744},{"x":4.999999910593033,"y":3.2775850755596876},{"x":5.0799999088048935,"y":3.2931850752110003},{"x":5.159999907016754,"y":3.308785074862313},{"x":5.239999905228615,"y":3.324385074513626},{"x":5.3199999034404755,"y":3.3399850741649386},{"x":5.399999901652336,"y":3.3555850738162514},{"x":5.479999899864197,"y":3.371185073467564},{"x":5.559999898076057,"y":3.386785073118877},{"x":5.639999896287918,"y":3.4023850727701896},{"x":5.719999894499779,"y":3.417985072421503},{"x":5.799999892711639,"y":3.4335850720728156},{"x":5.8799998909235,"y":3.4491850717241284},{"x":5.959999889135361,"y":3.4647850713754416},{"x":6.039999887347221,"y":3.4803850710267543},{"x":6.119999885559082,"y":3.495985070678067},{"x":6.199999883770943,"y":3.51158507032938},{"x":6.279999881982803,"y":3.5271850699806926},{"x":6.359999880194664,"y":3.5427850696320053},{"x":6.439999878406525,"y":3.558385069283318},{"x":6.519999876618385,"y":3.573985068934631},{"x":6.599999874830246,"y":3.5895850685859436},{"x":6.679999873042107,"y":3.605185068237257},{"x":6.759999871253967,"y":3.6207850678885696},{"x":6.839999869465828,"y":3.6363850675398823},{"x":6.919999867677689,"y":3.6519850671911955},{"x":6.999999865889549,"y":3.6675850668425083},{"x":7.07999986410141,"y":3.683185066493821},{"x":7.159999862313271,"y":3.698785066145134},{"x":7.239999860525131,"y":3.7143850657964466},{"x":7.319999858736992,"y":3.7299850654477593},{"x":7.3999998569488525,"y":3.745585065099072},{"x":7.479999855160713,"y":3.761185064750385},{"x":7.559999853372574,"y":3.7767850644016976},{"x":7.6399998515844345,"y":3.792385064053011},{"x":7.719999849796295,"y":3.8079850637043235},{"x":7.799999848008156,"y":3.8235850633556363},{"x":7.8799998462200165,"y":3.839185063006949},{"x":7.959999844431877,"y":3.8547850626582623},{"x":8.039999842643738,"y":3.870385062309575},{"x":8.119999840855598,"y":3.8859850619608878},{"x":8.199999839067459,"y":3.9015850616122005},{"x":8.27999983727932,"y":3.9171850612635133},{"x":8.35999983549118,"y":3.932785060914826},{"x":8.439999833703041,"y":3.948385060566139},{"x":8.519999831914902,"y":3.9639850602174516},{"x":8.599999830126762,"y":3.9795850598687643},{"x":8.679999828338623,"y":3.9951850595200775},{"x":8.759999826550484,"y":4.01078505917139},{"x":8.839999824762344,"y":4.026385058822703},{"x":8.919999822974205,"y":4.041985058474016},{"x":8.999999821186066,"y":4.057585058125329}]}],"marks":[{"type":"symbol","from":{"data":"f438c4db-e27c-4ced-bb7e-17915263ab77"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"1850e752-8a8f-4406-8f4e-aa7d5ffdb011"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [1 10]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :values ({:x 1, :y 2.4932054526026954} {:x 2, :y 2.4840729690394228} {:x 3, :y 2.711377991194885} {:x 4, :y 2.995232148512309} {:x 5, :y 3.202339856228101} {:x 6, :y 3.5564902660681907} {:x 7, :y 3.7805466426397603} {:x 8, :y 3.757005283161537} {:x 9, :y 3.8316802527456075})} {:name \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\", :values ({:x 1, :y 2.4975850929940457} {:x 1.0799999982118607, :y 2.513185092645359} {:x 1.1599999964237213, :y 2.5287850922966717} {:x 1.239999994635582, :y 2.5443850919479845} {:x 1.3199999928474426, :y 2.559985091599297} {:x 1.3999999910593033, :y 2.57558509125061} {:x 1.479999989271164, :y 2.5911850909019227} {:x 1.5599999874830246, :y 2.6067850905532355} {:x 1.6399999856948853, :y 2.6223850902045487} {:x 1.719999983906746, :y 2.6379850898558614} {:x 1.7999999821186066, :y 2.653585089507174} {:x 1.8799999803304672, :y 2.669185089158487} {:x 1.9599999785423279, :y 2.6847850888097997} {:x 2.0399999767541885, :y 2.700385088461113} {:x 2.119999974966049, :y 2.7159850881124257} {:x 2.19999997317791, :y 2.7315850877637384} {:x 2.2799999713897705, :y 2.747185087415051} {:x 2.359999969601631, :y 2.762785087066364} {:x 2.439999967813492, :y 2.7783850867176767} {:x 2.5199999660253525, :y 2.7939850863689895} {:x 2.599999964237213, :y 2.809585086020302} {:x 2.679999962449074, :y 2.8251850856716154} {:x 2.7599999606609344, :y 2.840785085322928} {:x 2.839999958872795, :y 2.856385084974241} {:x 2.9199999570846558, :y 2.8719850846255537} {:x 2.9999999552965164, :y 2.887585084276867} {:x 3.079999953508377, :y 2.9031850839281796} {:x 3.1599999517202377, :y 2.9187850835794924} {:x 3.2399999499320984, :y 2.934385083230805} {:x 3.319999948143959, :y 2.949985082882118} {:x 3.3999999463558197, :y 2.9655850825334307} {:x 3.4799999445676804, :y 2.9811850821847434} {:x 3.559999942779541, :y 2.996785081836056} {:x 3.6399999409914017, :y 3.0123850814873694} {:x 3.7199999392032623, :y 3.027985081138682} {:x 3.799999937415123, :y 3.043585080789995} {:x 3.8799999356269836, :y 3.0591850804413077} {:x 3.9599999338388443, :y 3.0747850800926204} {:x 4.039999932050705, :y 3.0903850797439336} {:x 4.119999930262566, :y 3.1059850793952464} {:x 4.199999928474426, :y 3.121585079046559} {:x 4.279999926686287, :y 3.137185078697872} {:x 4.359999924898148, :y 3.1527850783491846} {:x 4.439999923110008, :y 3.1683850780004974} {:x 4.519999921321869, :y 3.18398507765181} {:x 4.5999999195337296, :y 3.1995850773031234} {:x 4.67999991774559, :y 3.215185076954436} {:x 4.759999915957451, :y 3.230785076605749} {:x 4.8399999141693115, :y 3.2463850762570616} {:x 4.919999912381172, :y 3.2619850759083744} {:x 4.999999910593033, :y 3.2775850755596876} {:x 5.0799999088048935, :y 3.2931850752110003} {:x 5.159999907016754, :y 3.308785074862313} {:x 5.239999905228615, :y 3.324385074513626} {:x 5.3199999034404755, :y 3.3399850741649386} {:x 5.399999901652336, :y 3.3555850738162514} {:x 5.479999899864197, :y 3.371185073467564} {:x 5.559999898076057, :y 3.386785073118877} {:x 5.639999896287918, :y 3.4023850727701896} {:x 5.719999894499779, :y 3.417985072421503} {:x 5.799999892711639, :y 3.4335850720728156} {:x 5.8799998909235, :y 3.4491850717241284} {:x 5.959999889135361, :y 3.4647850713754416} {:x 6.039999887347221, :y 3.4803850710267543} {:x 6.119999885559082, :y 3.495985070678067} {:x 6.199999883770943, :y 3.51158507032938} {:x 6.279999881982803, :y 3.5271850699806926} {:x 6.359999880194664, :y 3.5427850696320053} {:x 6.439999878406525, :y 3.558385069283318} {:x 6.519999876618385, :y 3.573985068934631} {:x 6.599999874830246, :y 3.5895850685859436} {:x 6.679999873042107, :y 3.605185068237257} {:x 6.759999871253967, :y 3.6207850678885696} {:x 6.839999869465828, :y 3.6363850675398823} {:x 6.919999867677689, :y 3.6519850671911955} {:x 6.999999865889549, :y 3.6675850668425083} {:x 7.07999986410141, :y 3.683185066493821} {:x 7.159999862313271, :y 3.698785066145134} {:x 7.239999860525131, :y 3.7143850657964466} {:x 7.319999858736992, :y 3.7299850654477593} {:x 7.3999998569488525, :y 3.745585065099072} {:x 7.479999855160713, :y 3.761185064750385} {:x 7.559999853372574, :y 3.7767850644016976} {:x 7.6399998515844345, :y 3.792385064053011} {:x 7.719999849796295, :y 3.8079850637043235} {:x 7.799999848008156, :y 3.8235850633556363} {:x 7.8799998462200165, :y 3.839185063006949} {:x 7.959999844431877, :y 3.8547850626582623} {:x 8.039999842643738, :y 3.870385062309575} {:x 8.119999840855598, :y 3.8859850619608878} {:x 8.199999839067459, :y 3.9015850616122005} {:x 8.27999983727932, :y 3.9171850612635133} {:x 8.35999983549118, :y 3.932785060914826} {:x 8.439999833703041, :y 3.948385060566139} {:x 8.519999831914902, :y 3.9639850602174516} {:x 8.599999830126762, :y 3.9795850598687643} {:x 8.679999828338623, :y 3.9951850595200775} {:x 8.759999826550484, :y 4.01078505917139} {:x 8.839999824762344, :y 4.026385058822703} {:x 8.919999822974205, :y 4.041985058474016} {:x 8.999999821186066, :y 4.057585058125329})}), :marks ({:type \"symbol\", :from {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}],"value":"[[[[[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift],#'irr-1/values],#'irr-1/data],#'irr-1/transformed-data],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [1 10]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :values ({:x 1, :y 2.4932054526026954} {:x 2, :y 2.4840729690394228} {:x 3, :y 2.711377991194885} {:x 4, :y 2.995232148512309} {:x 5, :y 3.202339856228101} {:x 6, :y 3.5564902660681907} {:x 7, :y 3.7805466426397603} {:x 8, :y 3.757005283161537} {:x 9, :y 3.8316802527456075})} {:name \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\", :values ({:x 1, :y 2.4975850929940457} {:x 1.0799999982118607, :y 2.513185092645359} {:x 1.1599999964237213, :y 2.5287850922966717} {:x 1.239999994635582, :y 2.5443850919479845} {:x 1.3199999928474426, :y 2.559985091599297} {:x 1.3999999910593033, :y 2.57558509125061} {:x 1.479999989271164, :y 2.5911850909019227} {:x 1.5599999874830246, :y 2.6067850905532355} {:x 1.6399999856948853, :y 2.6223850902045487} {:x 1.719999983906746, :y 2.6379850898558614} {:x 1.7999999821186066, :y 2.653585089507174} {:x 1.8799999803304672, :y 2.669185089158487} {:x 1.9599999785423279, :y 2.6847850888097997} {:x 2.0399999767541885, :y 2.700385088461113} {:x 2.119999974966049, :y 2.7159850881124257} {:x 2.19999997317791, :y 2.7315850877637384} {:x 2.2799999713897705, :y 2.747185087415051} {:x 2.359999969601631, :y 2.762785087066364} {:x 2.439999967813492, :y 2.7783850867176767} {:x 2.5199999660253525, :y 2.7939850863689895} {:x 2.599999964237213, :y 2.809585086020302} {:x 2.679999962449074, :y 2.8251850856716154} {:x 2.7599999606609344, :y 2.840785085322928} {:x 2.839999958872795, :y 2.856385084974241} {:x 2.9199999570846558, :y 2.8719850846255537} {:x 2.9999999552965164, :y 2.887585084276867} {:x 3.079999953508377, :y 2.9031850839281796} {:x 3.1599999517202377, :y 2.9187850835794924} {:x 3.2399999499320984, :y 2.934385083230805} {:x 3.319999948143959, :y 2.949985082882118} {:x 3.3999999463558197, :y 2.9655850825334307} {:x 3.4799999445676804, :y 2.9811850821847434} {:x 3.559999942779541, :y 2.996785081836056} {:x 3.6399999409914017, :y 3.0123850814873694} {:x 3.7199999392032623, :y 3.027985081138682} {:x 3.799999937415123, :y 3.043585080789995} {:x 3.8799999356269836, :y 3.0591850804413077} {:x 3.9599999338388443, :y 3.0747850800926204} {:x 4.039999932050705, :y 3.0903850797439336} {:x 4.119999930262566, :y 3.1059850793952464} {:x 4.199999928474426, :y 3.121585079046559} {:x 4.279999926686287, :y 3.137185078697872} {:x 4.359999924898148, :y 3.1527850783491846} {:x 4.439999923110008, :y 3.1683850780004974} {:x 4.519999921321869, :y 3.18398507765181} {:x 4.5999999195337296, :y 3.1995850773031234} {:x 4.67999991774559, :y 3.215185076954436} {:x 4.759999915957451, :y 3.230785076605749} {:x 4.8399999141693115, :y 3.2463850762570616} {:x 4.919999912381172, :y 3.2619850759083744} {:x 4.999999910593033, :y 3.2775850755596876} {:x 5.0799999088048935, :y 3.2931850752110003} {:x 5.159999907016754, :y 3.308785074862313} {:x 5.239999905228615, :y 3.324385074513626} {:x 5.3199999034404755, :y 3.3399850741649386} {:x 5.399999901652336, :y 3.3555850738162514} {:x 5.479999899864197, :y 3.371185073467564} {:x 5.559999898076057, :y 3.386785073118877} {:x 5.639999896287918, :y 3.4023850727701896} {:x 5.719999894499779, :y 3.417985072421503} {:x 5.799999892711639, :y 3.4335850720728156} {:x 5.8799998909235, :y 3.4491850717241284} {:x 5.959999889135361, :y 3.4647850713754416} {:x 6.039999887347221, :y 3.4803850710267543} {:x 6.119999885559082, :y 3.495985070678067} {:x 6.199999883770943, :y 3.51158507032938} {:x 6.279999881982803, :y 3.5271850699806926} {:x 6.359999880194664, :y 3.5427850696320053} {:x 6.439999878406525, :y 3.558385069283318} {:x 6.519999876618385, :y 3.573985068934631} {:x 6.599999874830246, :y 3.5895850685859436} {:x 6.679999873042107, :y 3.605185068237257} {:x 6.759999871253967, :y 3.6207850678885696} {:x 6.839999869465828, :y 3.6363850675398823} {:x 6.919999867677689, :y 3.6519850671911955} {:x 6.999999865889549, :y 3.6675850668425083} {:x 7.07999986410141, :y 3.683185066493821} {:x 7.159999862313271, :y 3.698785066145134} {:x 7.239999860525131, :y 3.7143850657964466} {:x 7.319999858736992, :y 3.7299850654477593} {:x 7.3999998569488525, :y 3.745585065099072} {:x 7.479999855160713, :y 3.761185064750385} {:x 7.559999853372574, :y 3.7767850644016976} {:x 7.6399998515844345, :y 3.792385064053011} {:x 7.719999849796295, :y 3.8079850637043235} {:x 7.799999848008156, :y 3.8235850633556363} {:x 7.8799998462200165, :y 3.839185063006949} {:x 7.959999844431877, :y 3.8547850626582623} {:x 8.039999842643738, :y 3.870385062309575} {:x 8.119999840855598, :y 3.8859850619608878} {:x 8.199999839067459, :y 3.9015850616122005} {:x 8.27999983727932, :y 3.9171850612635133} {:x 8.35999983549118, :y 3.932785060914826} {:x 8.439999833703041, :y 3.948385060566139} {:x 8.519999831914902, :y 3.9639850602174516} {:x 8.599999830126762, :y 3.9795850598687643} {:x 8.679999828338623, :y 3.9951850595200775} {:x 8.759999826550484, :y 4.01078505917139} {:x 8.839999824762344, :y 4.026385058822703} {:x 8.919999822974205, :y 4.041985058474016} {:x 8.999999821186066, :y 4.057585058125329})}), :marks ({:type \"symbol\", :from {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[1,10]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"16de18c2-7032-4d63-8fad-f49eb91e078d","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"16de18c2-7032-4d63-8fad-f49eb91e078d","values":[{"x":1,"y":12.1},{"x":2,"y":11.99},{"x":3,"y":15.05},{"x":4,"y":19.99},{"x":5,"y":24.59},{"x":6,"y":35.04},{"x":7,"y":43.84},{"x":8,"y":42.82},{"x":9,"y":46.14}]},{"name":"8b1a55ee-b99a-4eff-9451-1734aa064a89","values":[{"x":1,"y":12.153109864897308},{"x":1.0799999982118607,"y":12.344184884687618},{"x":1.1599999964237213,"y":12.538264046100416},{"x":1.239999994635582,"y":12.73539458119617},{"x":1.3199999928474426,"y":12.93562446463267},{"x":1.3999999910593033,"y":13.139002425340387},{"x":1.479999989271164,"y":13.345577958381368},{"x":1.5599999874830246,"y":13.555401336994617},{"x":1.6399999856948853,"y":13.768523624830836},{"x":1.719999983906746,"y":13.9849966883795},{"x":1.7999999821186066,"y":14.204873209591385},{"x":1.8799999803304672,"y":14.428206698699473},{"x":1.9599999785423279,"y":14.65505150724148},{"x":2.0399999767541885,"y":14.885462841287115},{"x":2.119999974966049,"y":15.119496774873282},{"x":2.19999997317791,"y":15.357210263650565},{"x":2.2799999713897705,"y":15.598661158744212},{"x":2.359999969601631,"y":15.84390822083308},{"x":2.439999967813492,"y":16.093011134449917},{"x":2.5199999660253525,"y":16.34603052250649},{"x":2.599999964237213,"y":16.60302796104707},{"x":2.679999962449074,"y":16.864065994233886},{"x":2.7599999606609344,"y":17.12920814956817},{"x":2.839999958872795,"y":17.398518953350546},{"x":2.9199999570846558,"y":17.672063946384434},{"x":2.9999999552965164,"y":17.949909699926426},{"x":3.079999953508377,"y":18.232123831887343},{"x":3.1599999517202377,"y":18.518775023288104},{"x":3.2399999499320984,"y":18.809933034974264},{"x":3.319999948143959,"y":19.105668724593354},{"x":3.3999999463558197,"y":19.406054063839157},{"x":3.4799999445676804,"y":19.711162155967074},{"x":3.559999942779541,"y":20.02106725358491},{"x":3.6399999409914017,"y":20.335844776723363},{"x":3.7199999392032623,"y":20.65557133119056},{"x":3.799999937415123,"y":20.98032472721531},{"x":3.8799999356269836,"y":21.310183998383312},{"x":3.9599999338388443,"y":21.64522942087119},{"x":4.039999932050705,"y":21.9855425329829},{"x":4.119999930262566,"y":22.331206154993264},{"x":4.199999928474426,"y":22.682304409303562},{"x":4.279999926686287,"y":23.038922740913947},{"x":4.359999924898148,"y":23.401147938217765},{"x":4.439999923110008,"y":23.769068154122817},{"x":4.519999921321869,"y":24.14277292750466},{"x":4.5999999195337296,"y":24.52235320499727},{"x":4.67999991774559,"y":24.9079013631262},{"x":4.759999915957451,"y":25.299511230789854},{"x":4.8399999141693115,"y":25.69727811209411},{"x":4.919999912381172,"y":26.101298809546005},{"x":4.999999910593033,"y":26.511671647612086},{"x":5.0799999088048935,"y":26.92849649664708},{"x":5.159999907016754,"y":27.351874797198917},{"x":5.239999905228615,"y":27.781909584695743},{"x":5.3199999034404755,"y":28.21870551452115},{"x":5.399999901652336,"y":28.66236888748363},{"x":5.479999899864197,"y":29.11300767568644},{"x":5.559999898076057,"y":29.57073154880425},{"x":5.639999896287918,"y":30.035651900772883},{"x":5.719999894499779,"y":30.50788187689871},{"x":5.799999892711639,"y":30.987536401394195},{"x":5.8799998909235,"y":31.474732205346484},{"x":5.959999889135361,"y":31.969587855125646},{"x":6.039999887347221,"y":32.47222378123949},{"x":6.119999885559082,"y":32.982762307642254},{"x":6.199999883770943,"y":33.50132768150386},{"x":6.279999881982803,"y":34.028046103447366},{"x":6.359999880194664,"y":34.56304575826177},{"x":6.439999878406525,"y":35.10645684609767},{"x":6.519999876618385,"y":35.65841161415344},{"x":6.599999874830246,"y":36.21904438885951},{"x":6.679999873042107,"y":36.78849160856881},{"x":6.759999871253967,"y":37.36689185676093},{"x":6.839999869465828,"y":37.954385895768624},{"x":6.919999867677689,"y":38.55111670103435},{"x":6.999999865889549,"y":39.157229495905455},{"x":7.07999986410141,"y":39.77287178697651},{"x":7.159999862313271,"y":40.3981933999872},{"x":7.239999860525131,"y":41.033346516284674},{"x":7.319999858736992,"y":41.678485709859125},{"x":7.3999998569488525,"y":42.333767984961675},{"x":7.479999855160713,"y":42.99935281431375},{"x":7.559999853372574,"y":43.67540217791709},{"x":7.6399998515844345,"y":44.362080602474045},{"x":7.719999849796295,"y":45.05955520142752},{"x":7.799999848008156,"y":45.767995715630654},{"x":7.8799998462200165,"y":46.48757455465571},{"x":7.959999844431877,"y":47.21846683875252},{"x":8.039999842643738,"y":47.9608504414666},{"x":8.119999840855598,"y":48.71490603292738},{"x":8.199999839067459,"y":49.48081712381696},{"x":8.27999983727932,"y":50.25877011003014},{"x":8.35999983549118,"y":51.048954318036685},{"x":8.439999833703041,"y":51.85156205095671},{"x":8.519999831914902,"y":52.66678863536054},{"x":8.599999830126762,"y":53.49483246880434},{"x":8.679999828338623,"y":54.33589506811315},{"x":8.759999826550484,"y":55.190181118422885},{"x":8.839999824762344,"y":56.05789852299373},{"x":8.919999822974205,"y":56.93925845380639},{"x":8.999999821186066,"y":57.83447540295377}]}],"marks":[{"type":"symbol","from":{"data":"16de18c2-7032-4d63-8fad-f49eb91e078d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"8b1a55ee-b99a-4eff-9451-1734aa064a89"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [1 10]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"16de18c2-7032-4d63-8fad-f49eb91e078d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"16de18c2-7032-4d63-8fad-f49eb91e078d\", :values ({:x 1, :y 12.1} {:x 2, :y 11.99} {:x 3, :y 15.05} {:x 4, :y 19.99} {:x 5, :y 24.59} {:x 6, :y 35.04} {:x 7, :y 43.84} {:x 8, :y 42.82} {:x 9, :y 46.14})} {:name \"8b1a55ee-b99a-4eff-9451-1734aa064a89\", :values ({:x 1, :y 12.153109864897308} {:x 1.0799999982118607, :y 12.344184884687618} {:x 1.1599999964237213, :y 12.538264046100416} {:x 1.239999994635582, :y 12.73539458119617} {:x 1.3199999928474426, :y 12.93562446463267} {:x 1.3999999910593033, :y 13.139002425340387} {:x 1.479999989271164, :y 13.345577958381368} {:x 1.5599999874830246, :y 13.555401336994617} {:x 1.6399999856948853, :y 13.768523624830836} {:x 1.719999983906746, :y 13.9849966883795} {:x 1.7999999821186066, :y 14.204873209591385} {:x 1.8799999803304672, :y 14.428206698699473} {:x 1.9599999785423279, :y 14.65505150724148} {:x 2.0399999767541885, :y 14.885462841287115} {:x 2.119999974966049, :y 15.119496774873282} {:x 2.19999997317791, :y 15.357210263650565} {:x 2.2799999713897705, :y 15.598661158744212} {:x 2.359999969601631, :y 15.84390822083308} {:x 2.439999967813492, :y 16.093011134449917} {:x 2.5199999660253525, :y 16.34603052250649} {:x 2.599999964237213, :y 16.60302796104707} {:x 2.679999962449074, :y 16.864065994233886} {:x 2.7599999606609344, :y 17.12920814956817} {:x 2.839999958872795, :y 17.398518953350546} {:x 2.9199999570846558, :y 17.672063946384434} {:x 2.9999999552965164, :y 17.949909699926426} {:x 3.079999953508377, :y 18.232123831887343} {:x 3.1599999517202377, :y 18.518775023288104} {:x 3.2399999499320984, :y 18.809933034974264} {:x 3.319999948143959, :y 19.105668724593354} {:x 3.3999999463558197, :y 19.406054063839157} {:x 3.4799999445676804, :y 19.711162155967074} {:x 3.559999942779541, :y 20.02106725358491} {:x 3.6399999409914017, :y 20.335844776723363} {:x 3.7199999392032623, :y 20.65557133119056} {:x 3.799999937415123, :y 20.98032472721531} {:x 3.8799999356269836, :y 21.310183998383312} {:x 3.9599999338388443, :y 21.64522942087119} {:x 4.039999932050705, :y 21.9855425329829} {:x 4.119999930262566, :y 22.331206154993264} {:x 4.199999928474426, :y 22.682304409303562} {:x 4.279999926686287, :y 23.038922740913947} {:x 4.359999924898148, :y 23.401147938217765} {:x 4.439999923110008, :y 23.769068154122817} {:x 4.519999921321869, :y 24.14277292750466} {:x 4.5999999195337296, :y 24.52235320499727} {:x 4.67999991774559, :y 24.9079013631262} {:x 4.759999915957451, :y 25.299511230789854} {:x 4.8399999141693115, :y 25.69727811209411} {:x 4.919999912381172, :y 26.101298809546005} {:x 4.999999910593033, :y 26.511671647612086} {:x 5.0799999088048935, :y 26.92849649664708} {:x 5.159999907016754, :y 27.351874797198917} {:x 5.239999905228615, :y 27.781909584695743} {:x 5.3199999034404755, :y 28.21870551452115} {:x 5.399999901652336, :y 28.66236888748363} {:x 5.479999899864197, :y 29.11300767568644} {:x 5.559999898076057, :y 29.57073154880425} {:x 5.639999896287918, :y 30.035651900772883} {:x 5.719999894499779, :y 30.50788187689871} {:x 5.799999892711639, :y 30.987536401394195} {:x 5.8799998909235, :y 31.474732205346484} {:x 5.959999889135361, :y 31.969587855125646} {:x 6.039999887347221, :y 32.47222378123949} {:x 6.119999885559082, :y 32.982762307642254} {:x 6.199999883770943, :y 33.50132768150386} {:x 6.279999881982803, :y 34.028046103447366} {:x 6.359999880194664, :y 34.56304575826177} {:x 6.439999878406525, :y 35.10645684609767} {:x 6.519999876618385, :y 35.65841161415344} {:x 6.599999874830246, :y 36.21904438885951} {:x 6.679999873042107, :y 36.78849160856881} {:x 6.759999871253967, :y 37.36689185676093} {:x 6.839999869465828, :y 37.954385895768624} {:x 6.919999867677689, :y 38.55111670103435} {:x 6.999999865889549, :y 39.157229495905455} {:x 7.07999986410141, :y 39.77287178697651} {:x 7.159999862313271, :y 40.3981933999872} {:x 7.239999860525131, :y 41.033346516284674} {:x 7.319999858736992, :y 41.678485709859125} {:x 7.3999998569488525, :y 42.333767984961675} {:x 7.479999855160713, :y 42.99935281431375} {:x 7.559999853372574, :y 43.67540217791709} {:x 7.6399998515844345, :y 44.362080602474045} {:x 7.719999849796295, :y 45.05955520142752} {:x 7.799999848008156, :y 45.767995715630654} {:x 7.8799998462200165, :y 46.48757455465571} {:x 7.959999844431877, :y 47.21846683875252} {:x 8.039999842643738, :y 47.9608504414666} {:x 8.119999840855598, :y 48.71490603292738} {:x 8.199999839067459, :y 49.48081712381696} {:x 8.27999983727932, :y 50.25877011003014} {:x 8.35999983549118, :y 51.048954318036685} {:x 8.439999833703041, :y 51.85156205095671} {:x 8.519999831914902, :y 52.66678863536054} {:x 8.599999830126762, :y 53.49483246880434} {:x 8.679999828338623, :y 54.33589506811315} {:x 8.759999826550484, :y 55.190181118422885} {:x 8.839999824762344, :y 56.05789852299373} {:x 8.919999822974205, :y 56.93925845380639} {:x 8.999999821186066, :y 57.83447540295377})}), :marks ({:type \"symbol\", :from {:data \"16de18c2-7032-4d63-8fad-f49eb91e078d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"8b1a55ee-b99a-4eff-9451-1734aa064a89\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}],"value":"[[[[[[[[[#'irr-1/times,#'irr-1/true-mu],#'irr-1/true-delta],#'irr-1/true-const],#'irr-1/true-drift],#'irr-1/values],#'irr-1/data],#'irr-1/transformed-data],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [1 10]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"f438c4db-e27c-4ced-bb7e-17915263ab77\", :values ({:x 1, :y 2.4932054526026954} {:x 2, :y 2.4840729690394228} {:x 3, :y 2.711377991194885} {:x 4, :y 2.995232148512309} {:x 5, :y 3.202339856228101} {:x 6, :y 3.5564902660681907} {:x 7, :y 3.7805466426397603} {:x 8, :y 3.757005283161537} {:x 9, :y 3.8316802527456075})} {:name \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\", :values ({:x 1, :y 2.4975850929940457} {:x 1.0799999982118607, :y 2.513185092645359} {:x 1.1599999964237213, :y 2.5287850922966717} {:x 1.239999994635582, :y 2.5443850919479845} {:x 1.3199999928474426, :y 2.559985091599297} {:x 1.3999999910593033, :y 2.57558509125061} {:x 1.479999989271164, :y 2.5911850909019227} {:x 1.5599999874830246, :y 2.6067850905532355} {:x 1.6399999856948853, :y 2.6223850902045487} {:x 1.719999983906746, :y 2.6379850898558614} {:x 1.7999999821186066, :y 2.653585089507174} {:x 1.8799999803304672, :y 2.669185089158487} {:x 1.9599999785423279, :y 2.6847850888097997} {:x 2.0399999767541885, :y 2.700385088461113} {:x 2.119999974966049, :y 2.7159850881124257} {:x 2.19999997317791, :y 2.7315850877637384} {:x 2.2799999713897705, :y 2.747185087415051} {:x 2.359999969601631, :y 2.762785087066364} {:x 2.439999967813492, :y 2.7783850867176767} {:x 2.5199999660253525, :y 2.7939850863689895} {:x 2.599999964237213, :y 2.809585086020302} {:x 2.679999962449074, :y 2.8251850856716154} {:x 2.7599999606609344, :y 2.840785085322928} {:x 2.839999958872795, :y 2.856385084974241} {:x 2.9199999570846558, :y 2.8719850846255537} {:x 2.9999999552965164, :y 2.887585084276867} {:x 3.079999953508377, :y 2.9031850839281796} {:x 3.1599999517202377, :y 2.9187850835794924} {:x 3.2399999499320984, :y 2.934385083230805} {:x 3.319999948143959, :y 2.949985082882118} {:x 3.3999999463558197, :y 2.9655850825334307} {:x 3.4799999445676804, :y 2.9811850821847434} {:x 3.559999942779541, :y 2.996785081836056} {:x 3.6399999409914017, :y 3.0123850814873694} {:x 3.7199999392032623, :y 3.027985081138682} {:x 3.799999937415123, :y 3.043585080789995} {:x 3.8799999356269836, :y 3.0591850804413077} {:x 3.9599999338388443, :y 3.0747850800926204} {:x 4.039999932050705, :y 3.0903850797439336} {:x 4.119999930262566, :y 3.1059850793952464} {:x 4.199999928474426, :y 3.121585079046559} {:x 4.279999926686287, :y 3.137185078697872} {:x 4.359999924898148, :y 3.1527850783491846} {:x 4.439999923110008, :y 3.1683850780004974} {:x 4.519999921321869, :y 3.18398507765181} {:x 4.5999999195337296, :y 3.1995850773031234} {:x 4.67999991774559, :y 3.215185076954436} {:x 4.759999915957451, :y 3.230785076605749} {:x 4.8399999141693115, :y 3.2463850762570616} {:x 4.919999912381172, :y 3.2619850759083744} {:x 4.999999910593033, :y 3.2775850755596876} {:x 5.0799999088048935, :y 3.2931850752110003} {:x 5.159999907016754, :y 3.308785074862313} {:x 5.239999905228615, :y 3.324385074513626} {:x 5.3199999034404755, :y 3.3399850741649386} {:x 5.399999901652336, :y 3.3555850738162514} {:x 5.479999899864197, :y 3.371185073467564} {:x 5.559999898076057, :y 3.386785073118877} {:x 5.639999896287918, :y 3.4023850727701896} {:x 5.719999894499779, :y 3.417985072421503} {:x 5.799999892711639, :y 3.4335850720728156} {:x 5.8799998909235, :y 3.4491850717241284} {:x 5.959999889135361, :y 3.4647850713754416} {:x 6.039999887347221, :y 3.4803850710267543} {:x 6.119999885559082, :y 3.495985070678067} {:x 6.199999883770943, :y 3.51158507032938} {:x 6.279999881982803, :y 3.5271850699806926} {:x 6.359999880194664, :y 3.5427850696320053} {:x 6.439999878406525, :y 3.558385069283318} {:x 6.519999876618385, :y 3.573985068934631} {:x 6.599999874830246, :y 3.5895850685859436} {:x 6.679999873042107, :y 3.605185068237257} {:x 6.759999871253967, :y 3.6207850678885696} {:x 6.839999869465828, :y 3.6363850675398823} {:x 6.919999867677689, :y 3.6519850671911955} {:x 6.999999865889549, :y 3.6675850668425083} {:x 7.07999986410141, :y 3.683185066493821} {:x 7.159999862313271, :y 3.698785066145134} {:x 7.239999860525131, :y 3.7143850657964466} {:x 7.319999858736992, :y 3.7299850654477593} {:x 7.3999998569488525, :y 3.745585065099072} {:x 7.479999855160713, :y 3.761185064750385} {:x 7.559999853372574, :y 3.7767850644016976} {:x 7.6399998515844345, :y 3.792385064053011} {:x 7.719999849796295, :y 3.8079850637043235} {:x 7.799999848008156, :y 3.8235850633556363} {:x 7.8799998462200165, :y 3.839185063006949} {:x 7.959999844431877, :y 3.8547850626582623} {:x 8.039999842643738, :y 3.870385062309575} {:x 8.119999840855598, :y 3.8859850619608878} {:x 8.199999839067459, :y 3.9015850616122005} {:x 8.27999983727932, :y 3.9171850612635133} {:x 8.35999983549118, :y 3.932785060914826} {:x 8.439999833703041, :y 3.948385060566139} {:x 8.519999831914902, :y 3.9639850602174516} {:x 8.599999830126762, :y 3.9795850598687643} {:x 8.679999828338623, :y 3.9951850595200775} {:x 8.759999826550484, :y 4.01078505917139} {:x 8.839999824762344, :y 4.026385058822703} {:x 8.919999822974205, :y 4.041985058474016} {:x 8.999999821186066, :y 4.057585058125329})}), :marks ({:type \"symbol\", :from {:data \"f438c4db-e27c-4ced-bb7e-17915263ab77\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"1850e752-8a8f-4406-8f4e-aa7d5ffdb011\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [1 10]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"16de18c2-7032-4d63-8fad-f49eb91e078d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"16de18c2-7032-4d63-8fad-f49eb91e078d\", :values ({:x 1, :y 12.1} {:x 2, :y 11.99} {:x 3, :y 15.05} {:x 4, :y 19.99} {:x 5, :y 24.59} {:x 6, :y 35.04} {:x 7, :y 43.84} {:x 8, :y 42.82} {:x 9, :y 46.14})} {:name \"8b1a55ee-b99a-4eff-9451-1734aa064a89\", :values ({:x 1, :y 12.153109864897308} {:x 1.0799999982118607, :y 12.344184884687618} {:x 1.1599999964237213, :y 12.538264046100416} {:x 1.239999994635582, :y 12.73539458119617} {:x 1.3199999928474426, :y 12.93562446463267} {:x 1.3999999910593033, :y 13.139002425340387} {:x 1.479999989271164, :y 13.345577958381368} {:x 1.5599999874830246, :y 13.555401336994617} {:x 1.6399999856948853, :y 13.768523624830836} {:x 1.719999983906746, :y 13.9849966883795} {:x 1.7999999821186066, :y 14.204873209591385} {:x 1.8799999803304672, :y 14.428206698699473} {:x 1.9599999785423279, :y 14.65505150724148} {:x 2.0399999767541885, :y 14.885462841287115} {:x 2.119999974966049, :y 15.119496774873282} {:x 2.19999997317791, :y 15.357210263650565} {:x 2.2799999713897705, :y 15.598661158744212} {:x 2.359999969601631, :y 15.84390822083308} {:x 2.439999967813492, :y 16.093011134449917} {:x 2.5199999660253525, :y 16.34603052250649} {:x 2.599999964237213, :y 16.60302796104707} {:x 2.679999962449074, :y 16.864065994233886} {:x 2.7599999606609344, :y 17.12920814956817} {:x 2.839999958872795, :y 17.398518953350546} {:x 2.9199999570846558, :y 17.672063946384434} {:x 2.9999999552965164, :y 17.949909699926426} {:x 3.079999953508377, :y 18.232123831887343} {:x 3.1599999517202377, :y 18.518775023288104} {:x 3.2399999499320984, :y 18.809933034974264} {:x 3.319999948143959, :y 19.105668724593354} {:x 3.3999999463558197, :y 19.406054063839157} {:x 3.4799999445676804, :y 19.711162155967074} {:x 3.559999942779541, :y 20.02106725358491} {:x 3.6399999409914017, :y 20.335844776723363} {:x 3.7199999392032623, :y 20.65557133119056} {:x 3.799999937415123, :y 20.98032472721531} {:x 3.8799999356269836, :y 21.310183998383312} {:x 3.9599999338388443, :y 21.64522942087119} {:x 4.039999932050705, :y 21.9855425329829} {:x 4.119999930262566, :y 22.331206154993264} {:x 4.199999928474426, :y 22.682304409303562} {:x 4.279999926686287, :y 23.038922740913947} {:x 4.359999924898148, :y 23.401147938217765} {:x 4.439999923110008, :y 23.769068154122817} {:x 4.519999921321869, :y 24.14277292750466} {:x 4.5999999195337296, :y 24.52235320499727} {:x 4.67999991774559, :y 24.9079013631262} {:x 4.759999915957451, :y 25.299511230789854} {:x 4.8399999141693115, :y 25.69727811209411} {:x 4.919999912381172, :y 26.101298809546005} {:x 4.999999910593033, :y 26.511671647612086} {:x 5.0799999088048935, :y 26.92849649664708} {:x 5.159999907016754, :y 27.351874797198917} {:x 5.239999905228615, :y 27.781909584695743} {:x 5.3199999034404755, :y 28.21870551452115} {:x 5.399999901652336, :y 28.66236888748363} {:x 5.479999899864197, :y 29.11300767568644} {:x 5.559999898076057, :y 29.57073154880425} {:x 5.639999896287918, :y 30.035651900772883} {:x 5.719999894499779, :y 30.50788187689871} {:x 5.799999892711639, :y 30.987536401394195} {:x 5.8799998909235, :y 31.474732205346484} {:x 5.959999889135361, :y 31.969587855125646} {:x 6.039999887347221, :y 32.47222378123949} {:x 6.119999885559082, :y 32.982762307642254} {:x 6.199999883770943, :y 33.50132768150386} {:x 6.279999881982803, :y 34.028046103447366} {:x 6.359999880194664, :y 34.56304575826177} {:x 6.439999878406525, :y 35.10645684609767} {:x 6.519999876618385, :y 35.65841161415344} {:x 6.599999874830246, :y 36.21904438885951} {:x 6.679999873042107, :y 36.78849160856881} {:x 6.759999871253967, :y 37.36689185676093} {:x 6.839999869465828, :y 37.954385895768624} {:x 6.919999867677689, :y 38.55111670103435} {:x 6.999999865889549, :y 39.157229495905455} {:x 7.07999986410141, :y 39.77287178697651} {:x 7.159999862313271, :y 40.3981933999872} {:x 7.239999860525131, :y 41.033346516284674} {:x 7.319999858736992, :y 41.678485709859125} {:x 7.3999998569488525, :y 42.333767984961675} {:x 7.479999855160713, :y 42.99935281431375} {:x 7.559999853372574, :y 43.67540217791709} {:x 7.6399998515844345, :y 44.362080602474045} {:x 7.719999849796295, :y 45.05955520142752} {:x 7.799999848008156, :y 45.767995715630654} {:x 7.8799998462200165, :y 46.48757455465571} {:x 7.959999844431877, :y 47.21846683875252} {:x 8.039999842643738, :y 47.9608504414666} {:x 8.119999840855598, :y 48.71490603292738} {:x 8.199999839067459, :y 49.48081712381696} {:x 8.27999983727932, :y 50.25877011003014} {:x 8.35999983549118, :y 51.048954318036685} {:x 8.439999833703041, :y 51.85156205095671} {:x 8.519999831914902, :y 52.66678863536054} {:x 8.599999830126762, :y 53.49483246880434} {:x 8.679999828338623, :y 54.33589506811315} {:x 8.759999826550484, :y 55.190181118422885} {:x 8.839999824762344, :y 56.05789852299373} {:x 8.919999822974205, :y 56.93925845380639} {:x 8.999999821186066, :y 57.83447540295377})}), :marks ({:type \"symbol\", :from {:data \"16de18c2-7032-4d63-8fad-f49eb91e078d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"8b1a55ee-b99a-4eff-9451-1734aa064a89\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}]"}
;; <=

;; **
;;; The below query takes in a set of data and a future time `t`. It transforms the data by taking logarithms, and then fits a Gaussian process to this data, performing inference to find the drift of the Brownian motion process that best fits the data. It then samples this process at the future time `t`, and returns the value predicted by the geometric Brownian motion model at this future time `t`, as well as the posterior distribution over the drift:
;; **

;; @@
(defquery learn-gbm [data t]
  (declare :primitive GP-new evidence)
  (let [transformed-data (map (fn [[s x]] [s (log x)]) data)

        ;; some basic stats about the data to inform our prior
        ;; no, this is NOT illegal!
        data-min (reduce min (map second transformed-data))
        data-max (reduce max (map second transformed-data))

        ;; our prior over GP parameters:
        const (log 10) ;; the initial value
        mu (sample (normal 0 (/ 1 3)))
        delta 0.1
        drift (- mu (* delta delta 0.5))

        ;; our GP's functions:
        m (fn [t] (+ const (* drift t)))
        k (fn [s t] (* delta delta (min s t)))


        ;; form the posterior GP:
        gp (loop [n 0
                  gp (GP-new m k)]
             (if (= n (count data))
               gp
               (recur (+ n 1)
                      (absorb gp (nth transformed-data n)))))

        ;; get its model evidence and observe on that:
        model-evidence (exp (evidence gp))

        _ (observe (flip model-evidence) true)

        ;; get the log-prediction:
        log-prediction (sample ((produce gp) t))
        prediction (exp log-prediction)]


    {:prediction prediction :drift drift}))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/learn-gbm</span>","value":"#'irr-1/learn-gbm"}
;; <=

;; @@
(def S 10000)

(def results (map :result (take S 
                                (doquery :smc learn-gbm [data 15]
                                         :number-of-particles S))))

(def predicts (map :prediction results))
(def drifts (map :drift results))

(take-last 10 predicts)

"Drifts:"
(plot/histogram drifts :normalize :probability)

"Predictions:"
(plot/histogram predicts :normalize :probability)
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/S</span>","value":"#'irr-1/S"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/results</span>","value":"#'irr-1/results"}],"value":"[#'irr-1/S,#'irr-1/results]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/predicts</span>","value":"#'irr-1/predicts"}],"value":"[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/drifts</span>","value":"#'irr-1/drifts"}],"value":"[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts]"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>161.37008324281643</span>","value":"161.37008324281643"},{"type":"html","content":"<span class='clj-double'>113.09804599016246</span>","value":"113.09804599016246"},{"type":"html","content":"<span class='clj-double'>78.28132775455501</span>","value":"78.28132775455501"},{"type":"html","content":"<span class='clj-double'>170.06801017949505</span>","value":"170.06801017949505"},{"type":"html","content":"<span class='clj-double'>130.1322968679887</span>","value":"130.1322968679887"},{"type":"html","content":"<span class='clj-double'>149.75294623787164</span>","value":"149.75294623787164"},{"type":"html","content":"<span class='clj-double'>208.37254466496063</span>","value":"208.37254466496063"},{"type":"html","content":"<span class='clj-double'>103.06554954939189</span>","value":"103.06554954939189"},{"type":"html","content":"<span class='clj-double'>192.4694756132456</span>","value":"192.4694756132456"},{"type":"html","content":"<span class='clj-double'>104.81599965205764</span>","value":"104.81599965205764"}],"value":"(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)"}],"value":"[[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts],(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)]"},{"type":"html","content":"<span class='clj-string'>&quot;Drifts:&quot;</span>","value":"\"Drifts:\""}],"value":"[[[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts],(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)],\"Drifts:\"]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"72c87fd9-27e3-4610-8db3-43bb59990144","values":[{"x":-0.11493888671096637,"y":0},{"x":-0.07439757765289037,"y":0.0002},{"x":-0.03385626859481437,"y":0.0008},{"x":0.006685040463261627,"y":0.0039},{"x":0.04722634952133763,"y":0.0199},{"x":0.08776765857941363,"y":0.0599},{"x":0.1283089676374896,"y":0.1249},{"x":0.16885027669556563,"y":0.1982},{"x":0.20939158575364164,"y":0.2347},{"x":0.24993289481171765,"y":0.1894},{"x":0.29047420386979367,"y":0.1088},{"x":0.3310155129278697,"y":0.0425},{"x":0.3715568219859457,"y":0.0131},{"x":0.4120981310440217,"y":0.0033},{"x":0.4526394401020977,"y":0.0003},{"x":0.49318074916017374,"y":0.0001},{"x":0.5337220582182497,"y":0}]}],"marks":[{"type":"line","from":{"data":"72c87fd9-27e3-4610-8db3-43bb59990144"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"72c87fd9-27e3-4610-8db3-43bb59990144","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"72c87fd9-27e3-4610-8db3-43bb59990144","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"72c87fd9-27e3-4610-8db3-43bb59990144\", :values ({:x -0.11493888671096637, :y 0} {:x -0.07439757765289037, :y 2.0E-4} {:x -0.03385626859481437, :y 8.0E-4} {:x 0.006685040463261627, :y 0.0039} {:x 0.04722634952133763, :y 0.0199} {:x 0.08776765857941363, :y 0.0599} {:x 0.1283089676374896, :y 0.1249} {:x 0.16885027669556563, :y 0.1982} {:x 0.20939158575364164, :y 0.2347} {:x 0.24993289481171765, :y 0.1894} {:x 0.29047420386979367, :y 0.1088} {:x 0.3310155129278697, :y 0.0425} {:x 0.3715568219859457, :y 0.0131} {:x 0.4120981310440217, :y 0.0033} {:x 0.4526394401020977, :y 3.0E-4} {:x 0.49318074916017374, :y 1.0E-4} {:x 0.5337220582182497, :y 0})}], :marks [{:type \"line\", :from {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[[[[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts],(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)],\"Drifts:\"],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"72c87fd9-27e3-4610-8db3-43bb59990144\", :values ({:x -0.11493888671096637, :y 0} {:x -0.07439757765289037, :y 2.0E-4} {:x -0.03385626859481437, :y 8.0E-4} {:x 0.006685040463261627, :y 0.0039} {:x 0.04722634952133763, :y 0.0199} {:x 0.08776765857941363, :y 0.0599} {:x 0.1283089676374896, :y 0.1249} {:x 0.16885027669556563, :y 0.1982} {:x 0.20939158575364164, :y 0.2347} {:x 0.24993289481171765, :y 0.1894} {:x 0.29047420386979367, :y 0.1088} {:x 0.3310155129278697, :y 0.0425} {:x 0.3715568219859457, :y 0.0131} {:x 0.4120981310440217, :y 0.0033} {:x 0.4526394401020977, :y 3.0E-4} {:x 0.49318074916017374, :y 1.0E-4} {:x 0.5337220582182497, :y 0})}], :marks [{:type \"line\", :from {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"},{"type":"html","content":"<span class='clj-string'>&quot;Predictions:&quot;</span>","value":"\"Predictions:\""}],"value":"[[[[[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts],(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)],\"Drifts:\"],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"72c87fd9-27e3-4610-8db3-43bb59990144\", :values ({:x -0.11493888671096637, :y 0} {:x -0.07439757765289037, :y 2.0E-4} {:x -0.03385626859481437, :y 8.0E-4} {:x 0.006685040463261627, :y 0.0039} {:x 0.04722634952133763, :y 0.0199} {:x 0.08776765857941363, :y 0.0599} {:x 0.1283089676374896, :y 0.1249} {:x 0.16885027669556563, :y 0.1982} {:x 0.20939158575364164, :y 0.2347} {:x 0.24993289481171765, :y 0.1894} {:x 0.29047420386979367, :y 0.1088} {:x 0.3310155129278697, :y 0.0425} {:x 0.3715568219859457, :y 0.0131} {:x 0.4120981310440217, :y 0.0033} {:x 0.4526394401020977, :y 3.0E-4} {:x 0.49318074916017374, :y 1.0E-4} {:x 0.5337220582182497, :y 0})}], :marks [{:type \"line\", :from {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}],\"Predictions:\"]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"472a2d88-e7b1-487e-a6c9-4e78bb28d725","values":[{"x":20.52478490796436,"y":0},{"x":99.71164668856235,"y":0.2475},{"x":178.89850846916033,"y":0.4514},{"x":258.08537024975834,"y":0.2016},{"x":337.27223203035635,"y":0.0668},{"x":416.45909381095436,"y":0.0229},{"x":495.64595559155237,"y":0.0067},{"x":574.8328173721503,"y":0.002},{"x":654.0196791527483,"y":0.0004},{"x":733.2065409333462,"y":0.0002},{"x":812.3934027139442,"y":0.0003},{"x":891.5802644945421,"y":0.0001},{"x":970.7671262751401,"y":0},{"x":1049.9539880557381,"y":0},{"x":1129.1408498363362,"y":0},{"x":1208.3277116169343,"y":0.0001},{"x":1287.5145733975323,"y":0}]}],"marks":[{"type":"line","from":{"data":"472a2d88-e7b1-487e-a6c9-4e78bb28d725"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"472a2d88-e7b1-487e-a6c9-4e78bb28d725","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"472a2d88-e7b1-487e-a6c9-4e78bb28d725","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :values ({:x 20.52478490796436, :y 0} {:x 99.71164668856235, :y 0.2475} {:x 178.89850846916033, :y 0.4514} {:x 258.08537024975834, :y 0.2016} {:x 337.27223203035635, :y 0.0668} {:x 416.45909381095436, :y 0.0229} {:x 495.64595559155237, :y 0.0067} {:x 574.8328173721503, :y 0.002} {:x 654.0196791527483, :y 4.0E-4} {:x 733.2065409333462, :y 2.0E-4} {:x 812.3934027139442, :y 3.0E-4} {:x 891.5802644945421, :y 1.0E-4} {:x 970.7671262751401, :y 0.0} {:x 1049.9539880557381, :y 0.0} {:x 1129.1408498363362, :y 0.0} {:x 1208.3277116169343, :y 1.0E-4} {:x 1287.5145733975323, :y 0})}], :marks [{:type \"line\", :from {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[[[[[[[[#'irr-1/S,#'irr-1/results],#'irr-1/predicts],#'irr-1/drifts],(161.37008324281643 113.09804599016246 78.28132775455501 170.06801017949505 130.1322968679887 149.75294623787164 208.37254466496063 103.06554954939189 192.4694756132456 104.81599965205764)],\"Drifts:\"],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"72c87fd9-27e3-4610-8db3-43bb59990144\", :values ({:x -0.11493888671096637, :y 0} {:x -0.07439757765289037, :y 2.0E-4} {:x -0.03385626859481437, :y 8.0E-4} {:x 0.006685040463261627, :y 0.0039} {:x 0.04722634952133763, :y 0.0199} {:x 0.08776765857941363, :y 0.0599} {:x 0.1283089676374896, :y 0.1249} {:x 0.16885027669556563, :y 0.1982} {:x 0.20939158575364164, :y 0.2347} {:x 0.24993289481171765, :y 0.1894} {:x 0.29047420386979367, :y 0.1088} {:x 0.3310155129278697, :y 0.0425} {:x 0.3715568219859457, :y 0.0131} {:x 0.4120981310440217, :y 0.0033} {:x 0.4526394401020977, :y 3.0E-4} {:x 0.49318074916017374, :y 1.0E-4} {:x 0.5337220582182497, :y 0})}], :marks [{:type \"line\", :from {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"72c87fd9-27e3-4610-8db3-43bb59990144\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}],\"Predictions:\"],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :values ({:x 20.52478490796436, :y 0} {:x 99.71164668856235, :y 0.2475} {:x 178.89850846916033, :y 0.4514} {:x 258.08537024975834, :y 0.2016} {:x 337.27223203035635, :y 0.0668} {:x 416.45909381095436, :y 0.0229} {:x 495.64595559155237, :y 0.0067} {:x 574.8328173721503, :y 0.002} {:x 654.0196791527483, :y 4.0E-4} {:x 733.2065409333462, :y 2.0E-4} {:x 812.3934027139442, :y 3.0E-4} {:x 891.5802644945421, :y 1.0E-4} {:x 970.7671262751401, :y 0.0} {:x 1049.9539880557381, :y 0.0} {:x 1129.1408498363362, :y 0.0} {:x 1208.3277116169343, :y 1.0E-4} {:x 1287.5145733975323, :y 0})}], :marks [{:type \"line\", :from {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"472a2d88-e7b1-487e-a6c9-4e78bb28d725\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"}
;; <=

;; **
;;; Above, we see that the posterior distribution over the drift is approximately normal - however, the predictions for the value of the time series at `T=15` are a lognormal distribution, heavily skewed to the right.
;;; 
;;; This will make a large difference when we calculate the IRR of our investment. Here's that IRR code again:
;; **

;; @@
(defn npv-helper [rate lst]
  (apply +
         (map
           (fn [x i] (/ x
                        (Math/pow (+ 1 rate) i)))
           lst
           (range 1 (+ 1 (count lst))))))


;; for Newton-Raphson, we need the derivative of the above npv-helper function:
(defn npv-derivative [rate lst]
  (- (reduce +
            (map
              (fn [x i] (/
                          (* i x)
                          (Math/pow (+ 1 rate) (+ i 1))))
              lst
              (range 1 (+ 1 (count lst)))))))

;; for Halley's method, we need the second derivative:
(defn npv-second-derivative [rate lst]
  (reduce +
         (map
           (fn [x i] (/
                       (* i (+ i 1) x)
                       (Math/pow (+ 1 rate) (+ i 2))))
           lst
           (range 1 (+ 1 (count lst))))))




;; IRR-helper implements the IRR function using Halley's method
;; using the above two derivatives of the NPV function.

(defn newton-raphson [cash-flows guess]
  (let [max-iteration-count 20
        accuracy 0.0001]
    (loop [i 0
           x guess]
      (if (= i max-iteration-count)
        Double/NaN
        (let [value (npv-helper x cash-flows)
              derivative (npv-derivative x cash-flows)

              ratio (/ value derivative)
              next-x (- x ratio)
              current-accuracy (Math/abs (- next-x x))]

          (if (<= current-accuracy accuracy)
            x
            (recur (+ i 1) next-x)))))))

(defn irr [cash-flows guess]
  (newton-raphson cash-flows guess))



(irr [-1000 0 0 0 0 0 0 0 0 0 2000] 0.1)
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/npv-helper</span>","value":"#'irr-1/npv-helper"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/npv-derivative</span>","value":"#'irr-1/npv-derivative"}],"value":"[#'irr-1/npv-helper,#'irr-1/npv-derivative]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/npv-second-derivative</span>","value":"#'irr-1/npv-second-derivative"}],"value":"[[#'irr-1/npv-helper,#'irr-1/npv-derivative],#'irr-1/npv-second-derivative]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/newton-raphson</span>","value":"#'irr-1/newton-raphson"}],"value":"[[[#'irr-1/npv-helper,#'irr-1/npv-derivative],#'irr-1/npv-second-derivative],#'irr-1/newton-raphson]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/irr</span>","value":"#'irr-1/irr"}],"value":"[[[[#'irr-1/npv-helper,#'irr-1/npv-derivative],#'irr-1/npv-second-derivative],#'irr-1/newton-raphson],#'irr-1/irr]"},{"type":"html","content":"<span class='clj-double'>0.07177327702983588</span>","value":"0.07177327702983588"}],"value":"[[[[[#'irr-1/npv-helper,#'irr-1/npv-derivative],#'irr-1/npv-second-derivative],#'irr-1/newton-raphson],#'irr-1/irr],0.07177327702983588]"}
;; <=

;; **
;;; In the below query, we calculate a posterior distribution over the drift, sample a possible `future-profit` if we sell the investment at time `T`, and then return the IRR of the resulting cash-flow, just as we did in the previous sheet:
;; **

;; @@
(defquery gbm-irr [data T]
  (declare :primitive GP-new evidence irr)
  (let [transformed-data (map (fn [[s x]] [s (log x)]) data)

        ;; some basic stats about the data to inform our prior
        ;; no, this is NOT illegal!
        data-min (reduce min (map second transformed-data))
        data-max (reduce max (map second transformed-data))

        ;; our prior over GP parameters:
        const (log 10) ;; the initial value
        mu (sample (normal 0 (/ 1 3)))
        delta 0.1
        drift (- mu (* delta delta 0.5))

        ;; our GP's functions:
        m (fn [t] (+ const (* drift t)))
        k (fn [s t] (* delta delta (min s t)))


        ;; form the posterior GP:
        gp (loop [n 0
                  gp (GP-new m k)]
             (if (= n (count data))
               gp
               (recur (+ n 1)
                      (absorb gp (nth transformed-data n)))))

        ;; get its model evidence and observe on that:
        model-evidence (exp (evidence gp))

        _ (observe (flip model-evidence) true)

        ;; next, having done that, we compute the IRR
        ;; of the cashflow in which we buy this asset at time zero and then sell it
        ;; at time T:
        initial-spend -10
        future-profit (exp (sample ((produce gp) T)))
        cash-flow (concat (list initial-spend)
                          (repeat (- T 2) 0) 
                          (list future-profit))]

    (irr cash-flow 0.1)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/gbm-irr</span>","value":"#'irr-1/gbm-irr"}
;; <=

;; @@
(def S 10000)

(def irrs (map :result (take S 
                                (doquery :smc gbm-irr [data 10]
                                         :number-of-particles S))))

(take-last 10 irrs)

(def not-nan-irrs (filter #(not (Double/isNaN %)) irrs))

(plot/histogram not-nan-irrs :normalize :probability)
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/S</span>","value":"#'irr-1/S"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/irrs</span>","value":"#'irr-1/irrs"}],"value":"[#'irr-1/S,#'irr-1/irrs]"},{"type":"list-like","open":"<span class='clj-list'>(</span>","close":"<span class='clj-list'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.22713523039581812</span>","value":"0.22713523039581812"},{"type":"html","content":"<span class='clj-double'>0.22152133674939925</span>","value":"0.22152133674939925"},{"type":"html","content":"<span class='clj-double'>0.2091421963605243</span>","value":"0.2091421963605243"},{"type":"html","content":"<span class='clj-double'>0.20419730350905402</span>","value":"0.20419730350905402"},{"type":"html","content":"<span class='clj-double'>0.20368784279056923</span>","value":"0.20368784279056923"},{"type":"html","content":"<span class='clj-double'>0.19544163684053228</span>","value":"0.19544163684053228"},{"type":"html","content":"<span class='clj-double'>0.17785994520412154</span>","value":"0.17785994520412154"},{"type":"html","content":"<span class='clj-double'>0.20992915228351167</span>","value":"0.20992915228351167"},{"type":"html","content":"<span class='clj-double'>0.21828944161883962</span>","value":"0.21828944161883962"},{"type":"html","content":"<span class='clj-double'>0.22221682483850086</span>","value":"0.22221682483850086"}],"value":"(0.22713523039581812 0.22152133674939925 0.2091421963605243 0.20419730350905402 0.20368784279056923 0.19544163684053228 0.17785994520412154 0.20992915228351167 0.21828944161883962 0.22221682483850086)"}],"value":"[[#'irr-1/S,#'irr-1/irrs],(0.22713523039581812 0.22152133674939925 0.2091421963605243 0.20419730350905402 0.20368784279056923 0.19544163684053228 0.17785994520412154 0.20992915228351167 0.21828944161883962 0.22221682483850086)]"},{"type":"html","content":"<span class='clj-var'>#&#x27;irr-1/not-nan-irrs</span>","value":"#'irr-1/not-nan-irrs"}],"value":"[[[#'irr-1/S,#'irr-1/irrs],(0.22713523039581812 0.22152133674939925 0.2091421963605243 0.20419730350905402 0.20368784279056923 0.19544163684053228 0.17785994520412154 0.20992915228351167 0.21828944161883962 0.22221682483850086)],#'irr-1/not-nan-irrs]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"3100cf26-75e4-43de-973c-ec81c300eb78","values":[{"x":0.14903373156906613,"y":0},{"x":0.15777166165794423,"y":0.001},{"x":0.16650959174682234,"y":0.0037},{"x":0.17524752183570044,"y":0.0127},{"x":0.18398545192457855,"y":0.0416},{"x":0.19272338201345665,"y":0.0931},{"x":0.20146131210233476,"y":0.1593},{"x":0.21019924219121286,"y":0.1973},{"x":0.21893717228009096,"y":0.2043},{"x":0.22767510236896907,"y":0.1509},{"x":0.23641303245784717,"y":0.0844},{"x":0.24515096254672528,"y":0.0364},{"x":0.2538888926356034,"y":0.0118},{"x":0.2626268227244815,"y":0.0031},{"x":0.27136475281335964,"y":0.0002},{"x":0.2801026829022378,"y":0.0002},{"x":0.2888406129911159,"y":0}]}],"marks":[{"type":"line","from":{"data":"3100cf26-75e4-43de-973c-ec81c300eb78"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"3100cf26-75e4-43de-973c-ec81c300eb78","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"3100cf26-75e4-43de-973c-ec81c300eb78","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"3100cf26-75e4-43de-973c-ec81c300eb78\", :values ({:x 0.14903373156906613, :y 0} {:x 0.15777166165794423, :y 0.001} {:x 0.16650959174682234, :y 0.0037} {:x 0.17524752183570044, :y 0.0127} {:x 0.18398545192457855, :y 0.0416} {:x 0.19272338201345665, :y 0.0931} {:x 0.20146131210233476, :y 0.1593} {:x 0.21019924219121286, :y 0.1973} {:x 0.21893717228009096, :y 0.2043} {:x 0.22767510236896907, :y 0.1509} {:x 0.23641303245784717, :y 0.0844} {:x 0.24515096254672528, :y 0.0364} {:x 0.2538888926356034, :y 0.0118} {:x 0.2626268227244815, :y 0.0031} {:x 0.27136475281335964, :y 2.0E-4} {:x 0.2801026829022378, :y 2.0E-4} {:x 0.2888406129911159, :y 0})}], :marks [{:type \"line\", :from {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[[[[#'irr-1/S,#'irr-1/irrs],(0.22713523039581812 0.22152133674939925 0.2091421963605243 0.20419730350905402 0.20368784279056923 0.19544163684053228 0.17785994520412154 0.20992915228351167 0.21828944161883962 0.22221682483850086)],#'irr-1/not-nan-irrs],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"3100cf26-75e4-43de-973c-ec81c300eb78\", :values ({:x 0.14903373156906613, :y 0} {:x 0.15777166165794423, :y 0.001} {:x 0.16650959174682234, :y 0.0037} {:x 0.17524752183570044, :y 0.0127} {:x 0.18398545192457855, :y 0.0416} {:x 0.19272338201345665, :y 0.0931} {:x 0.20146131210233476, :y 0.1593} {:x 0.21019924219121286, :y 0.1973} {:x 0.21893717228009096, :y 0.2043} {:x 0.22767510236896907, :y 0.1509} {:x 0.23641303245784717, :y 0.0844} {:x 0.24515096254672528, :y 0.0364} {:x 0.2538888926356034, :y 0.0118} {:x 0.2626268227244815, :y 0.0031} {:x 0.27136475281335964, :y 2.0E-4} {:x 0.2801026829022378, :y 2.0E-4} {:x 0.2888406129911159, :y 0})}], :marks [{:type \"line\", :from {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"3100cf26-75e4-43de-973c-ec81c300eb78\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"}
;; <=

;; **
;;; As mentioned previously, the results of this exercise are substantially different. While the discrete-time Gaussian random walk model we used last time was skittish about the investment, this geometric Brownian motion model is strongly positive. The IRR is overwhelmingly likely to be above 18%, a very high return that strongly dominates risk-free interest rates we could get elsewhere. The investment is therefore deemed very desirable.
;; **
